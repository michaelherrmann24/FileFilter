!function(){APP={NAME:"FileFilter",MODULE:{MAIN:"FF_MAIN",FILE:"FF_FILE",COMMON:"FF_COMMON",NAV:"FF_NAV",FILTER:"FF_FILTER",MENU:"FF_MENU",WORKER:"FF_WORKER"}},angular.element(document).ready(function(){angular.module(APP.NAME,[APP.MODULE.COMMON,APP.MODULE.WORKER,APP.MODULE.MAIN,APP.MODULE.NAV,APP.MODULE.MENU,APP.MODULE.FILE,APP.MODULE.FILTER]),angular.bootstrap(document,[APP.NAME])})}(),function(){"use strict";angular.module(APP.MODULE.COMMON,[])}(),function(){"use strict";angular.module(APP.MODULE.FILE,[])}(),function(){"use strict";angular.module(APP.MODULE.FILTER,[])}(),function(){"use strict";angular.module(APP.MODULE.MAIN,[])}(),function(){"use strict";angular.module(APP.MODULE.MENU,[])}(),function(){"use strict";angular.module(APP.MODULE.NAV,[])}(),function(){"use strict";angular.module(APP.MODULE.WORKER,[])}(),function(){"use strict";angular.module(APP.MODULE.COMMON).constant("SITE",{HTML:{BASE_DIR:"./dist/templates"},WORK_MANAGER:{THREADS:12},FILE:{BUFFER_SIZE:1048576}})}(),function(){"use strict";function a(a,b,c){function d(b){this.file=b,this.fileMapper=new c(b),this.deferred=a.defer(),this.fileMapperExecuteComplete=!1,this.noChunksProcessed=0}function e(a){var b=a;return function(a){return console.error("file read error",a),b.deferred.reject(a)}}function f(a){var b=a;return function(a){console.debug("generateFctnThen",new Date),b.noChunks=a.length,b.fileMapperExecuteComplete=!0,h(b,b.file)}}function g(a,b){var c=a;return function(b){a.fileMapper.processChunk(b).then(function(a){c.deferred.notify(a),c.noChunksProcessed=c.noChunksProcessed+1,h(c,b)})}}function h(a,b){var c=a;c.isComplete()&&(console.debug("generate file map end ",new Date),c.deferred.resolve(b))}return d.prototype.generate=function(){var a=this;console.debug("generate file map start ",new Date);this.fileMapper.execute().then(f(a),e(a),g(a,this.notifyPostProcessor));return this.deferred.promise},d.prototype.isComplete=function(){var a=this.fileMapperExecuteComplete&&this.noChunks===this.noChunksProcessed;return a},d}angular.module(APP.MODULE.COMMON).factory("FileMapGenerator",["$q","$timeout","FileMapper",a])}(),function(){"use strict";function a(a,b){function c(a,b){this.fileModel=a,this.filter=b}return c.prototype.generate=function(){var a=new b(this.fileModel,this.filter);a.seperateIntoChunks()},c.prototype.cancel=function(){},c}angular.module(APP.MODULE.COMMON).factory("FilterMapGenerator",["$q","FilterMapper",a])}(),function(){"use strict";function a(a){function b(a,b){return c(a,b),{pre:d,post:e}}function c(a,b){}function d(a,b,c){}function e(a,b,c){}return{restrict:"E",templateUrl:"./dist/templates/svgIcon.htm",replace:!0,scope:{icon:"@",iconClass:"="},compile:b}}angular.module(APP.MODULE.COMMON).directive("svgIcon",["$document",a])}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"./dist/svg/svg-defs.comb.svg",replace:!0,scope:{}}}angular.module(APP.MODULE.COMMON).directive("svgInclude",[a])}(),function(){function a(a){return function(d){if(angular.isDefined(d)&&!isNaN(d)){for(var e=0,f=1;d/f>1;)f*=c,e++;var g=d/(f/c);return a("number")(g,2)+" "+b[e-1]}return d}}angular.module(APP.MODULE.FILE).filter("fileSizeFilter",["$filter",a]);var b=["B","KB","MB","GB","TB"],c=1024}(),function(){"use strict";function a(a,b,c){return{restrict:"E",templateUrl:c.HTML.BASE_DIR+"/fileContent.htm",replace:!0,scope:{},link:function(c,d,e){c.pageView=b,c.fileView=a}}}angular.module(APP.MODULE.FILE).directive("fileContent",["fileView","pageView","SITE",a])}(),function(){function a(a,b){function c(b,c,d){b.fileView=a}return{restrict:"E",templateUrl:b.HTML.BASE_DIR+"/fileDetails.htm",replace:!0,transclude:!0,scope:{},controller:["$scope","$element","$attrs",c],controllerAs:"fileDetailsCtrl"}}angular.module(APP.MODULE.FILE).directive("fileDetails",["fileView","SITE",a])}(),function(){"use strict";function a(a,b){return{restrict:"E",replace:!0,templateUrl:b.HTML.BASE_DIR+"/fileLine.htm",link:function(b,c,d){a.model.readLine(b.line).then(function(a){b.lineContent=a,b.lineNo=b.line.row})}}}angular.module(APP.MODULE.FILE).directive("fileLine",["fileView","SITE",a])}(),function(){"use strict";function a(a,b,c,d,e,f,g){function h(h,i,j){function k(a){a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="copy"}function l(i){i.stopPropagation(),i.preventDefault(),a.model=new c(i.dataTransfer.files[0]),b.model=new d,f.model=new g,h.$applyAsync(),new e(a.model).generate().then(function(b){console.debug("file map completed",b,a.model),a.model=b},function(a){console.debug("error",a)},function(a){b.model.totalLines=a.length})["finally"](function(){console.debug("finally"),h.$applyAsync()})}i.bind("dragover",k),i.bind("drop",l)}return{restrict:"A",scope:{type:"@fileSelect"},controller:["$scope","$element","$attrs","$timeout",h],controllerAs:"fileSelectCtrl"}}angular.module(APP.MODULE.FILE).directive("fileSelect",["fileView","pageView","FileModel","Page","FileMapGenerator","FiltersView","Filters",a])}(),function(){"use strict";function a(a,b,c){function d(a,b,d){this.start=a,this.end=b,this.file=d,this.firstLine,this.lastLine,this.lines=[],this.reader=new c(d),this.deferred}return d.prototype.serialize=function(){return{executable:"ChunkMapper",parameters:[this.start,this.end,this.file],properties:{index:this.index,firstLine:this.firstLine,lastLine:this.lastLine,lines:this.lines}}},d.prototype.execute=function(){return this.deferred=a.defer(),this.reader.readBytes(this.start,this.end).then(this.mapChunk(this)),this.deferred.promise},d.prototype.cancel=function(){this.deferred.reject("CANCELLED")},d.prototype.mapChunk=function(a){var c=a;return function(a){for(var d=new Uint8Array(a),e=c.start,f=0;f<d.length;f++)if(10===d[f]){var g=c.start+f;if(c.firstLine){var h=new b(e,g,!0);c.lines.push(h)}else c.firstLine=new b(e,g,!0);e=g+1}e<c.start+d.length&&(c.lastLine=new b(e,c.start+d.length,!1)),c.deferred.resolve(c.serialize())}},d}angular.module(APP.MODULE.FILE).factory("ChunkMapper",["$q","Line","fileReaderSrvc",a])}(),function(){"use strict";function a(a,b,c){function d(a){var b=0;this.fileModel=a,this.observers=[],Object.defineProperty(this,"currentIndex",{get:function(){return b},set:function(a){b=a,this._triggerObserver()}})}function e(a,b){var c=a;c.row=b.lines.length+1,b.lines.push(c)}function f(a,b){return!a.hasLineFeed}function g(a,b){return new c(a.start,b.end,b.hasLineFeed)}function h(a,b,c){this.processor=b,this.deferred=c,this.chunk=a}return d.prototype.processChunk=function(b){console.debug();var c=a.defer(),d=b.properties;0===d.index&&console.debug("first chunk notify",new Date);var e=new h(d,this,c);return this.observers[d.index]=e,this._triggerObserver(),c.promise},d.prototype._triggerObserver=function(){var a=this.observers[this.currentIndex];a&&a.process()},d.prototype._processChunk=function(a,b){var c=b,d=a;if(0===this.fileModel.lines.length)e(d.firstLine,this.fileModel);else if(f(this.fileModel.lines[this.fileModel.lines.length-1],d.firstLine)){var h=g(this.fileModel.lines.pop(),d.firstLine);e(h,this.fileModel)}var i=this.fileModel;d.lines.forEach(function(a){e(a,i)}),d.lastLine&&e(d.lastLine,this.fileModel),this.currentIndex++,c.resolve(this.fileModel.lines)},h.prototype.process=function(){delete this.processor.observers[this.chunk.index],this.processor._processChunk(this.chunk,this.deferred)},d}angular.module(APP.MODULE.FILE).factory("ChunkProcessor",["$q","$timeout","Line",a])}(),function(){"use strict";function a(a,b,c,d,e){function f(a){this.fileModel=a,this.file=a.file,this.processor=new e(a)}return f.prototype.execute=function(){var a=this.seperateIntoChunks();return c.execute(a).then(function(a){return a})},f.prototype.seperateIntoChunks=function(){for(var a=[],c=0;c<this.file.size;){var e=Math.min(this.file.size,c+b.FILE.BUFFER_SIZE);a.push(new d(c,e,this.file)),a[a.length-1].index=a.length-1,c=e+1}return a},f.prototype.processChunk=function(a){return this.processor.processChunk(a)},f}angular.module(APP.MODULE.FILE).factory("FileMapper",["$q","SITE","WorkManager","ChunkMapper","ChunkProcessor",a])}(),function(){"use strict";function a(a,b){function c(a){this.file=a,this.fileReader=new b(a),this.lines=[]}return c.prototype.readLine=function(a){return this.fileReader.read(a.start,a.end)},c}angular.module(APP.MODULE.FILE).factory("FileModel",["$q","fileReaderSrvc",a])}(),function(){"use strict";function a(){function a(a,b,c){this.row,this.start=a,this.end=b,this.hasLineFeed=c}return a}angular.module(APP.MODULE.FILE).factory("Line",[a])}(),function(){"use strict";function a(a){function b(a){this.file=a}function c(a,b){return function(){b.resolve(a.result)}}function d(a,b){return function(){b.reject(a.result)}}function e(a){var b=new FileReader;return b.onload=c(b,a),b.onerror=d(b,a),b}return b.prototype.readBytes=function(b,c){var d=a.defer(),f=e(d);return f.readAsArrayBuffer(this.file.slice(b,c)),d.promise},b.prototype.read=function(b,c){var d=a.defer(),f=e(d);return f.readAsText(this.file.slice(b,c)),d.promise},b}angular.module(APP.MODULE.FILE).factory("fileReaderSrvc",["$q",a])}(),function(){"use strict";function a(){var a;Object.defineProperty(this,"model",{configurable:!1,enumerable:!1,get:function(){return a},set:function(b){a=b}})}angular.module(APP.MODULE.FILE).service("fileView",[a])}(),function(){"use strict";function a(){function a(a,b,c){}function b(a,b,c){console.debug("filter directive link",a.filter)}return{restrict:"E",templateUrl:"./templates/filters/filter.htm",replace:!0,scope:{filter:"=fltr"},controller:["$scope","$element","$attrs",b],controllerAs:"filterCtrl",link:a}}angular.module(APP.MODULE.FILTER).directive("ffFilter",[a])}(),function(){"use strict";function a(a){function b(a,b,c){console.debug("filter group directive link",a.group)}function c(a,b,c){}return{restrict:"E",templateUrl:"./templates/filters/filterGroup.htm",replace:!0,scope:{group:"=group"},controller:["$scope","$element","$attrs",c],controllerAs:"filterGroupCtrl",link:b}}angular.module(APP.MODULE.FILTER).directive("ffFilterGroup",[a])}(),function(){"use strict";function a(a){function b(a,b,c){}return{restrict:"E",templateUrl:"./templates/filters/filters.htm",replace:!0,scope:{},controller:["$scope","$element","$attrs",b],controllerAs:"filtersCtrl",link:function(b,c,d){console.debug("filters directive link"),b.view=a}}}angular.module(APP.MODULE.FILTER).directive("ffFilters",["FiltersView",a])}(),function(){"use strict";function a(a){function b(a){var b="";this.index=a,this.type,this.filterMap=[],this.watchers=[],Object.defineProperty(this,"value",{configurable:!1,enumerable:!0,get:function(){return console.debug("get filter value",b),b},set:function(a){console.debug("set ilter value",b,a),b=a,this._generateFilterMap()}})}return b.prototype._generateFilterMap=function(){"undefined"!=typeof this.generator&&null!=this.generator&&this.generator.cancel(),this.generator=new a,this.generator.generate()},b}angular.module(APP.MODULE.FILTER).factory("Filter",["FilterMapGenerator",a])}(),function(){"use strict";function a(a){function b(b){this.index=b,this.filters=[new a(0)]}return b.prototype.addFilter=function(){this.filters.push(new a(this.filters.length))},b.prototype.removeFilter=function(a){this.filters.splice(a.index,1)},b}angular.module(APP.MODULE.FILTER).factory("FilterGroup",["Filter",a])}(),function(){"use strict";function a(a,b){function c(a,b){this.fileModel=a,this.filter=b}var d=1e3;return c.prototype.execute=function(){this.seperateIntoChunks()},c.prototype.seperateIntoChunks=function(){for(var a=[],b=0;b<this.fileModel.fileMap.length;b+=d){var c=Math.min(b+d,this.fileModel.fileMap.length);a.push(this.fileModel.fileMap.slice(b,c))}return console.debug("chunks",a),a},c.prototype.processChunk=function(a){},c.postProcess=function(a){},c}angular.module(APP.MODULE.FILTER).factory("FilterMapper",["$q","WorkManager",a])}(),function(){"use strict";function a(a){function b(){this.groups=[new a(0)]}return b.prototype.addGroup=function(){this.groups.push(new a(this.groups.length))},b.prototype.removeGroup=function(a){this.groups.splice(a.index,1)},b}angular.module(APP.MODULE.FILTER).factory("Filters",["FilterGroup",a])}(),function(){"use strict";function a(){this.model,this.visible=!1}angular.module(APP.MODULE.FILTER).service("FiltersView",[a]),a.prototype.toggleVisible=function(){this.visible=!this.visible}}(),function(){"use strict";function a(a,b){this.model=b}var b=angular.module(APP.MODULE.MAIN);b.controller("mainController",["$scope","mainModel",a])}(),function(){"use strict";function a(){function a(){this.fileModel,this.filterModel,this.pageModel}return a.prototype.setFileModel=function(a){this.fileModel=a},a.prototype.setFilterModel=function(a){this.filteredFileModel=fileModel},a.prototype.setPageModel=function(a){this.pageModel=a},a.prototype.getFileModel=function(){return this.fileModel},new a}angular.module(APP.MODULE.MAIN).service("mainModel",[a])}(),function(){"use strict";function a(a){function b(a,b,c){}return{restrict:"E",templateUrl:a.HTML.BASE_DIR+"/menu.htm",replace:!0,scope:{},controller:["$scope","$element","$attrs",b],controllerAs:"menuCtrl"}}angular.module(APP.MODULE.MENU).directive("menu",["SITE",a])}(),function(){"use strict";function a(a,b){function c(){}return c.getMenuOption=function(c,d){console.debug("getMenuOption",c,d);var e;switch(d.menuSelector){case"filter":e=new b(c,d);break;default:e=new a(c,d)}return e},c}angular.module(APP.MODULE.MENU).service("MenuOptionFactory",["MenuOption","FilterOption",a])}(),function(){"use strict";function a(a,b){function c(b,c){return a.call(this,b,c)}return c.prototype=Object.create(a.prototype),c.prototype.constructor=c,c.prototype.compile=function(b,c){a.prototype.compile.apply(this,[b,c])},c.prototype.preLink=function(b,c,d){a.prototype.preLink.apply(this,[b,c,d])},c.prototype.postLink=function(c,d,e){a.prototype.postLink.apply(this,[c,d,e]),d.bind("click",function(a){b.toggleVisible()})},c}angular.module(APP.MODULE.NAV).factory("FilterOption",["MenuOption","FiltersView",a])}(),function(){"use strict";function a(){function a(a,b){return this.compile(a,b),{pre:this.preLink,post:this.postLink}}return a.prototype.compile=function(a,b){},a.prototype.preLink=function(a,b,c){},a.prototype.postLink=function(a,b,c){a.selected=!1,b.bind("click",function(b){a.selected=!a.selected,a.$applyAsync()})},a}angular.module(APP.MODULE.NAV).factory("MenuOption",[a])}(),function(){"use strict";function a(a){return{restrict:"A",compile:a.getMenuOption}}angular.module(APP.MODULE.MENU).directive("menuSelector",["MenuOptionFactory",a])}(),function(){"use strict";function a(){return{restrict:"A",require:"^^pagination",link:function(a,b,c,d){b.bind("click",d.first)}}}angular.module(APP.MODULE.NAV).directive("first",a)}(),function(){"use strict";function a(){return{restrict:"A",require:"^^pagination",link:function(a,b,c,d){b.bind("click",d.last)}}}angular.module(APP.MODULE.NAV).directive("last",a)}(),function(){"use strict";function a(){return{restrict:"A",require:"^^pagination",link:function(a,b,c,d){b.bind("click",d.next)}}}angular.module(APP.MODULE.NAV).directive("next",a)}(),function(){"use strict";function a(a,b,c){function d(c,d,e){function f(a,c){a!=c&&(b.model.totalLines=a)}function g(){return angular.isDefined(a.model)&&angular.isDefined(a.model.displayMap)?a.model.displayMap.length:0}c.pageView=b;e.scrollTo;this.next=function(){b.model.currentPage<b.model.totalPages&&(b.model.currentPage++,c.$apply())},this.prev=function(){b.model.currentPage>1&&(b.model.currentPage--,c.$apply())},this.first=function(){b.model.currentPage=1,c.$apply()},this.last=function(){b.model.currentPage=b.model.totalPages,c.$apply()},c.$watch(g,f)}return{restrict:"E",templateUrl:c.HTML.BASE_DIR+"/pagination.htm",replace:!0,scope:{},controller:["$scope","$element","$attrs",d],controllerAs:"pagingCtrl"}}angular.module(APP.MODULE.NAV).directive("pagination",["fileView","pageView","SITE",a])}(),function(){"use strict";function a(a,b){return{restrict:"E",templateUrl:b.HTML.BASE_DIR+"/pagingDetails.htm",replace:!0,scope:{},link:function(b){b.pageView=a}}}angular.module(APP.MODULE.NAV).directive("pagingDetails",["pageView","SITE",a])}(),function(){"use strict";function a(){return{restrict:"A",require:"^^pagination",link:function(a,b,c,d){b.bind("click",d.prev)}}}angular.module(APP.MODULE.NAV).directive("prev",a)}(),function(){"use strict";function a(){function a(){Object.defineProperty(this,"currentPage",{configurable:!1,enumerable:!1,get:function(){return e},set:function(a){e=a}}),Object.defineProperty(this,"linesPerPage",{configurable:!1,enumerable:!1,get:function(){return h},set:function(a){h=a,e=1,f=b()}}),Object.defineProperty(this,"totalLines",{configurable:!1,enumerable:!1,get:function(){return g},set:function(a){g=a,f=b()}}),Object.defineProperty(this,"totalPages",{configurable:!1,enumerable:!1,get:function(){return f}})}function b(){if(!isNaN(h)&&!isNaN(g)){var a=Math.max(h,1),b=Math.ceil(g/a);return Math.max(b,1)}return 1}var c=200,d=1,e=1,f=d,g=0,h=c;return a}angular.module(APP.MODULE.NAV).factory("Page",[a])}(),function(){"use strict";function a(){var a;Object.defineProperty(this,"model",{configurable:!1,enumerable:!1,get:function(){return a},set:function(b){a=b}})}angular.module(APP.MODULE.NAV).service("pageView",[a])}(),function(){"use strict";function a(a,b){b.setPoolSize(a.WORK_MANAGER.THREADS)}angular.module(APP.MODULE.WORKER).config(["SITE","WorkManagerProvider",a])}(),function(){"use strict";function a(){function a(a){c=a>0?a:1}function b(a,b,d,e){function f(){this.pool=new d}function g(b,c){var d,e,f=b,g=c,h=function(){return g.pool.getWorker()},i=function(a){return d=a,d.execute(f)},j=function(a){e.resolve(a)},k=function(){g.pool.returnWorker(d)};this.execute=function(){return e=a.defer(),h().then(i).then(j).then(k),e.promise}}return f.prototype.initialise=function(){for(var a=this.pool,b=0;c>b;b++)!function(b){b.initialise().then(function(){a.returnWorker(b)})}(new e)},f.prototype.execute=function(b){var c=a.defer(),d=[],e=this;return b.forEach(function(a){var b=new g(a,e).execute().then(function(a){return c.notify(a),a});d.push(b)}),a.all(d).then(function(a){c.resolve(a)}),c.promise},new f}var c=1;return{setPoolSize:a,$get:["$q","$timeout","WorkerPool","FFWorker",b]}}angular.module(APP.MODULE.WORKER).provider("WorkManager",[a])}(),function(){"use strict";function a(a){a.initialise()}angular.module(APP.MODULE.WORKER).run(["WorkManager",a])}(),function(){"use strict";function a(a,b,c){function d(){var b=e;e++;var d,f=!1;this.getIdentifier=function(){return b},this.initialise=function(){var b=a.defer(),e=c.template(),f=new Blob([e],{type:"application/javascript"}),g=window.URL.createObjectURL(f),h=function(a){var c=a.data.event;"initDone"===c?b.resolve("worker initialized"):b.reject(a)};return d=new Worker(g),d.onmessage=h,b.promise},this.execute=function(b){if(f)return a.reject("Worker is locked by another process");var c=a.defer(),e=b.serialize(),g=function(a){var b=a.data,d=a.data.event;switch(d){case"initDone":c.reject(a);break;case"success":c.resolve(b.data);break;case"notify":c.notify(b.data);break;case"error":c.reject(a);break;default:console.debug("rejecting worker execute - unknow msg from worker"),c.reject(a)}f=!1};return d.onmessage=g,d.postMessage(e),c.promise},this.terminate=function(){d&&d.terminate()}}var e=0;return d}angular.module(APP.MODULE.WORKER).factory("FFWorker",["$q","$timeout","WorkerTemplate",a])}(),function(){"use strict";function a(a){function b(){this.pool=[],this.queue=[]}return b.prototype.getWorker=function(){var b=a.defer();return this.queue.push(b),this.notifyQueued(),b.promise},b.prototype.returnWorker=function(a){this.pool.push(a),this.notifyPooled()},b.prototype.notifyQueued=function(){this.resolveRequest()},b.prototype.notifyPooled=function(){this.resolveRequest()},b.prototype.resolveRequest=function(){if(this.queue.length>0&&this.pool.length>0){var a=this.queue.shift();a.resolve(this.pool.pop())}},b}angular.module(APP.MODULE.WORKER).factory("WorkerPool",["$q",a])}(),function(){"use strict";function a(a){return["","APP = {","NAME: 'Worker',","MODULE: {","FILE : 'FF_FILE',","COMMON : 'FF_COMMON',","FILTER : 'FF_FILTER',","WORKER : 'FF_WORKER'","}","};","var window = self;","self.history = {};","var document = {","readyState: 'complete',","cookie: '',","querySelector: function () {},","createElement: function () {","return {","pathname: '',","setAttribute: function () {}","};","}","};","importScripts('"+a+"dist/lib/ng.min.js');","importScripts('"+a+"dist/javascript/Worker.min.js');","angular = window.angular;","angular.module(APP.NAME,[APP.MODULE.WORKER,APP.MODULE.FILE]);","angular.bootstrap(null, [APP.NAME]);"].join("\n")}function b(b){function c(){var c=a(b.absUrl());return console.debug("template",c),c}return{template:c}}angular.module(APP.MODULE.WORKER).service("WorkerTemplate",["$location",b])}();
//# sourceMappingURL=FileFilter.min.js.map